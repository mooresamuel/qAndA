{"ast":null,"code":"import{useEffect,useState}from\"react\";import{useExerciseData}from\"../Contexts/ExerciseContext\";import ExerciseExplain from\"../components/ExerciseExplain/ExerciseExplain\";import ExerciseEntryPoint from\"./ExerciseEntryPoint\";import ExerciseChatEntry from\"../components/ExerciseChatEntry/ExerciseChatEntry\";import{fetchAIEndExerciseAnswers}from\"../services/AIChatAPI\";import ExerciseFinished from\"../components/ExerciseFinished/ExerciseFinished\";import ChatWaitingIndicator from\"../components/ChatWaitingIndicator/ChatWaitingIndicator\";import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function NewExerciseFlow(){const[data,setData]=useState([{type:\"explain\"}]);const[chat,setChat]=useState([{role:\"user\",content:\"evaluate the exercise\"},{role:\"assistant\",content:`\n        <evaluation>Great effort! I see you struggled with the words \"pay\" and \"train\". This shows good attention to getting the pronunciation just right. While you read through the remaining words smoothly, I'd be happy to provide some additional practice with similar 'ay' and 'ai' words if you'd like to strengthen those patterns even further. Would you like to try practice a few more similar words?</evaluation><add_words>day, play, stay, way, say</add_words>`},{role:\"user\",content:\"evaluate the exercise\"},{role:\"assistant\",content:`I see you got all the questions right, great job!`}]);const{questionIndex,exercise,isLoading,handleMoveToNextQuestion,resetMistakes,getMistakesCurrentQuestion}=useExerciseData();//   useEffect(\n//     function () {\n//       setInterval(function () {\n//         window.scrollTo(0, document.body.scrollHeight);\n//       }, 200);\n//     },\n//     [data]\n//   );\nconst[isSending,setIsSending]=useState();const handleQuestionCompleted=async()=>{setIsSending(true);try{const prompt={exercise_details:getMistakesCurrentQuestion()};const data=await fetchAIEndExerciseAnswers({chat:[...chat,{role:\"user\",content:prompt}],...prompt});setChat(curr=>[...curr,prompt]);setChat(curr=>[...curr,data]);setData(chat=>[...chat,{type:\"chat\",message:data.response,data:data}]);}catch(err){console.log(err);}finally{setIsSending(false);}};function handleAddAiQuestion(newQuestion){resetMistakes();setData(data=>[...data,{type:\"question\",question:newQuestion}]);}function handleAddPrePlannedQuestion(){resetMistakes();if(questionIndex===exercise.questions.length-1){handleAddFinalStep();}else{const question=handleMoveToNextQuestion();setData(data=>[...data,{type:\"question\",question:question}]);}}function handleAddFinalStep(){setData(data=>[...data,{type:\"final\"}]);}if(isLoading)return null;return/*#__PURE__*/_jsxs(\"div\",{className:\"bg-slate-50\",children:[data.map((el,i)=>{if(el.type===\"explain\")return/*#__PURE__*/_jsx(ExerciseExplain,{setData:setData},i);if(el.type===\"question\")return/*#__PURE__*/_jsx(ExerciseEntryPoint,{onComplete:handleQuestionCompleted,question:el.question},i);if(el.type===\"chat\")return/*#__PURE__*/_jsx(ExerciseChatEntry,{data:el.data,handleAddAiQuestion:handleAddAiQuestion,handleAddPrePlannedQuestion:handleAddPrePlannedQuestion,message:el.message},i);if(el.type===\"final\")return/*#__PURE__*/_jsx(ExerciseFinished,{},i);return null;}),/*#__PURE__*/_jsx(\"div\",{className:\"flex justify-center my-4 scale-125\",children:isSending&&/*#__PURE__*/_jsx(ChatWaitingIndicator,{})})]});}export default NewExerciseFlow;","map":{"version":3,"names":["useEffect","useState","useExerciseData","ExerciseExplain","ExerciseEntryPoint","ExerciseChatEntry","fetchAIEndExerciseAnswers","ExerciseFinished","ChatWaitingIndicator","jsx","_jsx","jsxs","_jsxs","NewExerciseFlow","data","setData","type","chat","setChat","role","content","questionIndex","exercise","isLoading","handleMoveToNextQuestion","resetMistakes","getMistakesCurrentQuestion","isSending","setIsSending","handleQuestionCompleted","prompt","exercise_details","curr","message","response","err","console","log","handleAddAiQuestion","newQuestion","question","handleAddPrePlannedQuestion","questions","length","handleAddFinalStep","className","children","map","el","i","onComplete"],"sources":["/home/samoore/tpd/new/src/pages/NewExerciseFlow.js"],"sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useExerciseData } from \"../Contexts/ExerciseContext\";\r\nimport ExerciseExplain from \"../components/ExerciseExplain/ExerciseExplain\";\r\nimport ExerciseEntryPoint from \"./ExerciseEntryPoint\";\r\nimport ExerciseChatEntry from \"../components/ExerciseChatEntry/ExerciseChatEntry\";\r\nimport { fetchAIEndExerciseAnswers } from \"../services/AIChatAPI\";\r\nimport ExerciseFinished from \"../components/ExerciseFinished/ExerciseFinished\";\r\nimport ChatWaitingIndicator from \"../components/ChatWaitingIndicator/ChatWaitingIndicator\";\r\n\r\nfunction NewExerciseFlow() {\r\n  const [data, setData] = useState([{ type: \"explain\" }]);\r\n  const [chat, setChat] = useState([\r\n    { role: \"user\", content: \"evaluate the exercise\" },\r\n    {\r\n      role: \"assistant\",\r\n      content: `\r\n        <evaluation>Great effort! I see you struggled with the words \"pay\" and \"train\". This shows good attention to getting the pronunciation just right. While you read through the remaining words smoothly, I'd be happy to provide some additional practice with similar 'ay' and 'ai' words if you'd like to strengthen those patterns even further. Would you like to try practice a few more similar words?</evaluation><add_words>day, play, stay, way, say</add_words>`,\r\n    },\r\n    { role: \"user\", content: \"evaluate the exercise\" },\r\n    {\r\n      role: \"assistant\",\r\n      content: `I see you got all the questions right, great job!`,\r\n    },\r\n  ]);\r\n  const {\r\n    questionIndex,\r\n    exercise,\r\n    isLoading,\r\n    handleMoveToNextQuestion,\r\n    resetMistakes,\r\n    getMistakesCurrentQuestion,\r\n  } = useExerciseData();\r\n\r\n  //   useEffect(\r\n  //     function () {\r\n  //       setInterval(function () {\r\n  //         window.scrollTo(0, document.body.scrollHeight);\r\n  //       }, 200);\r\n  //     },\r\n  //     [data]\r\n  //   );\r\n\r\n  const [isSending, setIsSending] = useState();\r\n\r\n  const handleQuestionCompleted = async () => {\r\n    setIsSending(true);\r\n    try {\r\n      const prompt = {\r\n        exercise_details: getMistakesCurrentQuestion(),\r\n      };\r\n\r\n      const data = await fetchAIEndExerciseAnswers({\r\n        chat: [...chat, { role: \"user\", content: prompt }],\r\n        ...prompt,\r\n      });\r\n      setChat((curr) => [...curr, prompt]);\r\n      setChat((curr) => [...curr, data]);\r\n      setData((chat) => [\r\n        ...chat,\r\n        { type: \"chat\", message: data.response, data: data },\r\n      ]);\r\n    } catch (err) {\r\n      console.log(err);\r\n    } finally {\r\n      setIsSending(false);\r\n    }\r\n  };\r\n\r\n  function handleAddAiQuestion(newQuestion) {\r\n    resetMistakes();\r\n    setData((data) => [...data, { type: \"question\", question: newQuestion }]);\r\n  }\r\n\r\n  function handleAddPrePlannedQuestion() {\r\n    resetMistakes();\r\n\r\n    if (questionIndex === exercise.questions.length - 1) {\r\n      handleAddFinalStep();\r\n    } else {\r\n      const question = handleMoveToNextQuestion();\r\n      setData((data) => [...data, { type: \"question\", question: question }]);\r\n    }\r\n  }\r\n\r\n  function handleAddFinalStep() {\r\n    setData((data) => [...data, { type: \"final\" }]);\r\n  }\r\n\r\n  if (isLoading) return null;\r\n\r\n  return (\r\n    <div className=\"bg-slate-50\">\r\n      {data.map((el, i) => {\r\n        if (el.type === \"explain\")\r\n          return <ExerciseExplain key={i} setData={setData} />;\r\n        if (el.type === \"question\")\r\n          return (\r\n            <ExerciseEntryPoint\r\n              onComplete={handleQuestionCompleted}\r\n              question={el.question}\r\n              key={i}\r\n            />\r\n          );\r\n        if (el.type === \"chat\")\r\n          return (\r\n            <ExerciseChatEntry\r\n              data={el.data}\r\n              handleAddAiQuestion={handleAddAiQuestion}\r\n              handleAddPrePlannedQuestion={handleAddPrePlannedQuestion}\r\n              key={i}\r\n              message={el.message}\r\n            />\r\n          );\r\n\r\n        if (el.type === \"final\") return <ExerciseFinished key={i} />;\r\n        return null;\r\n      })}\r\n      <div className=\"flex justify-center my-4 scale-125\">\r\n        {isSending && <ChatWaitingIndicator />}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default NewExerciseFlow;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}